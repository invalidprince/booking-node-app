<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        h1, h2 { color: #333; }
        .section { background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        input, select, button { padding: 8px; margin: 5px 0; width: 100%; max-width: 400px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #eee; }
        .btn-danger { background: red; color: white; border: none; cursor: pointer; padding: 5px 8px; }
        .btn-primary { background: #007BFF; color: white; border: none; cursor: pointer; padding: 8px 12px; }
    </style>
</head>
<body>

<h1>Admin Portal</h1>

<div class="section">
    <h2>Manage Spaces</h2>
    <input type="text" id="spaceName" placeholder="Space name (e.g., Office 1)">
    <select id="spaceType">
        <option value="office">Office</option>
        <option value="desk">Desk</option>
        <option value="conference">Conference Room</option>
    </select>
    <input type="number" id="spaceOrder" placeholder="Auto-book priority order">
    <button class="btn-primary" onclick="addSpace()">Add Space</button>

    <h3>Existing Spaces</h3>
    <table id="spacesTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Priority Order</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="section">
    <h2>Manage Bookings</h2>
    <input type="text" id="bookingName" placeholder="Full Name">
    <input type="email" id="bookingEmail" placeholder="Email Address">
    <select id="bookingSpace"></select>
    <input type="date" id="bookingDate">
    <input type="time" id="bookingStart">
    <input type="time" id="bookingEnd">
    <label><input type="checkbox" id="recurringBooking"> Recurring Booking</label>
    <button class="btn-primary" onclick="addBooking()">Add Booking</button>

    <h3>Existing Bookings</h3>
    <table id="bookingsTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Space</th>
                <th>Date</th>
                <th>Time</th>
                <th>Recurring</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="section">
    <h2>Manage Admin Users</h2>
    <input type="text" id="adminUsername" placeholder="Username">
    <input type="password" id="adminPassword" placeholder="Password">
    <button class="btn-primary" onclick="addAdminUser()">Add Admin User</button>

    <h3>Existing Admins</h3>
    <table id="adminsTable">
        <thead>
            <tr>
                <th>Username</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    async function fetchSpaces() {
        const res = await fetch('/api/spaces');
        const spaces = await res.json();
        const tbody = document.querySelector('#spacesTable tbody');
        const select = document.querySelector('#bookingSpace');
        tbody.innerHTML = '';
        select.innerHTML = '';
        spaces.forEach(space => {
            tbody.innerHTML += `
                <tr>
                    <td>${space.name}</td>
                    <td>${space.type}</td>
                    <td>${space.priorityOrder}</td>
                    <td><button class="btn-danger" onclick="deleteSpace('${space.id}')">Delete</button></td>
                </tr>
            `;
            select.innerHTML += `<option value="${space.id}">${space.name}</option>`;
        });
    }

    async function addSpace() {
        const name = document.getElementById('spaceName').value;
        const type = document.getElementById('spaceType').value;
        const order = document.getElementById('spaceOrder').value;
        await fetch('/api/spaces', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, type, priorityOrder: order }) });
        fetchSpaces();
    }

    async function deleteSpace(id) {
        await fetch(`/api/spaces/${id}`, { method: 'DELETE' });
        fetchSpaces();
    }

    async function fetchBookings() {
        const res = await fetch('/api/bookings');
        const bookings = await res.json();
        const tbody = document.querySelector('#bookingsTable tbody');
        tbody.innerHTML = '';
        bookings.forEach(b => {
            tbody.innerHTML += `
                <tr>
                    <td>${b.name}</td>
                    <td>${b.email}</td>
                    <td>${b.spaceName}</td>
                    <td>${b.date}</td>
                    <td>${b.startTime} - ${b.endTime}</td>
                    <td>${b.recurring ? 'Yes' : 'No'}</td>
                    <td><button class="btn-danger" onclick="deleteBooking('${b.id}')">Delete</button></td>
                </tr>
            `;
        });
    }

    async function addBooking() {
        const name = document.getElementById('bookingName').value;
        const email = document.getElementById('bookingEmail').value;
        const spaceId = document.getElementById('bookingSpace').value;
        const date = document.getElementById('bookingDate').value;
        const startTime = document.getElementById('bookingStart').value;
        const endTime = document.getElementById('bookingEnd').value;
        const recurring = document.getElementById('recurringBooking').checked;
        await fetch('/api/bookings', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, email, spaceId, date, startTime, endTime, recurring }) });
        fetchBookings();
    }

    async function deleteBooking(id) {
        await fetch(`/api/bookings/${id}`, { method: 'DELETE' });
        fetchBookings();
    }

    async function fetchAdmins() {
        const res = await fetch('/api/admins');
        const admins = await res.json();
        const tbody = document.querySelector('#adminsTable tbody');
        tbody.innerHTML = '';
        admins.forEach(a => {
            tbody.innerHTML += `
                <tr>
                    <td>${a.username}</td>
                    <td><button class="btn-danger" onclick="deleteAdmin('${a.id}')">Delete</button></td>
                </tr>
            `;
        });
    }

    async function addAdminUser() {
        const username = document.getElementById('adminUsername').value;
        const password = document.getElementById('adminPassword').value;
        await fetch('/api/admins', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, password }) });
        fetchAdmins();
    }

    async function deleteAdmin(id) {
        await fetch(`/api/admins/${id}`, { method: 'DELETE' });
        fetchAdmins();
    }

    fetchSpaces();
    fetchBookings();
    fetchAdmins();
</script>

</body>
</html>
